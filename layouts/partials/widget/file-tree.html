{{/*
    file-tree.html – Collapsible tree based on Categories taxonomy.
    Each category acts like a folder; inside lists all pages under that category.
    Place in layouts/partials/file-tree.html (or themes/<theme>/...)
  */}}
  
  {{- $current := .Page -}}
  {{- $limit := default 50 .Params.limit -}}  {{/* allow override via calling partial */}}
  
  <nav class="file-tree" aria-label="Categories navigation">
    <div class="widget-icon">
        {{ partial "helper/icon" "archives" }}
    </div>
    <h2 class="widget-title section-title">{{ T "widget.fileTree.title" }}</h2>
    <ul class="tree-root">
    {{/* iterate categories by count; change to Alphabetical if desired */}}
    {{- range first $limit site.Taxonomies.categories.ByCount }}
      {{- $cat := . }}               {{/* . is TaxonomyTerm */}}
  
      {{/* determine if this category should be open */}}
      {{- $open := false }}
      {{- if eq $current.RelPermalink $cat.Page.RelPermalink -}}
          {{- $open = true -}}
      {{- else if in (slice) 0 -}}
          {{- /* placeholder – Hugo needs boolean; will be overridden below */ -}}
      {{- end -}}
      {{- if not $open }}
          {{- range $cat.Pages -}}
              {{- if eq .RelPermalink $current.RelPermalink }}
                  {{- $open = true }}
              {{- end -}}
          {{- end -}}
      {{- end }}
  
      <li class="tree-node">
        <details {{ if $open }}open{{ end }}>
          <summary>
            <a class="tree-label" href="{{ $cat.Page.RelPermalink }}">
              {{ $cat.Page.Title }}
            </a>
          </summary>
  
          <ul class="tree-children">
          {{- range sort $cat.Pages "Weight" "Title" }}
            <li class="tree-leaf">
              <a href="{{ .RelPermalink }}" {{ if eq $current.RelPermalink .RelPermalink }}class="active"{{ end }}>
                {{ .Title }}
              </a>
            </li>
          {{- end }}
          </ul>
        </details>
      </li>
    {{- end }}
    </ul>
  </nav>
  